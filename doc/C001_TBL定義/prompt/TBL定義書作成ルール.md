# TBL定義書作成ルール

## 概要
このドキュメントは、TBL定義書を作成する際に準拠すべきルールを定義したプロンプトファイルです。

## TBL名命名規則

### TBL名プレフィックス
- **マスタテーブル**: `mst_` で始める
  - 例: `mst_user`, `mst_department`, `mst_position`
- **履歴テーブル**: `his_` で始める
  - 例: `his_employee`, `his_login`
- **その他テーブル**: `tbl_` で始める
  - 例: `tbl_employee_historie`, `tbl_order`

### ファイル名
- 形式: `テーブル名（日本語名）.md`
- 例: `mst_user（ユーザーマスタ）.md`, `his_employee（社員履歴）.md`, `tbl_order（注文）.md`

### ディレクトリ
- 配置場所: `doc/C001_TBL定義/` ディレクトリ配下

## ファイル構成

### 基本構造
```markdown
## TBL名：テーブル名（日本語名）

### 1. テーブル概要
テーブルの目的と概要を1〜2行で記載。

### 2. テーブル定義
テーブル定義表を記載。

### 3. 区分値定義
区分値（選択肢）があるカラムの場合、値と意味を記載。
※フラグ値（0/1）は原則として記載不要。
```

## テーブル定義表の記載ルール

### カラム構成
```
| カラム名 | カラム名（論理名） | データ型 | サイズ | NULL許可 | デフォルト | 制約 | 説明 |
|----------|-------------------|----------|--------|----------|------------|------|------|
```

### カラム順序（必須）
1. **id（PK）**: 必ず最初に配置
2. **外部キーカラム**: PKの直後に配置（複数ある場合は順次記載）
3. **その他の業務カラム**: 外部キーの後に配置
4. **システムカラム**: 最後に配置
   - created_at（作成日時）
   - updated_at（更新日時）

### カラム命名規則

#### 基本原則
- **カラム名と論理名の統一**: 「カラム名」と「カラム名（論理名）」は同じ意味になるよう命名する
- **テーブル間の一貫性**: 同じ意味のカラムは異なるテーブルでも同一のカラム名を使用する
- **英語での統一**: カラム名は英語で統一し、論理名で日本語の意味を表現する

#### 外部キーカラム
- **基本形**: プレフィックス（mst_/his_/tbl_）を除外したテーブル名 + _id
  - 例: mst_user → user_id、mst_department → department_id
- **同一テーブルの外部キーが複数ある場合**: 先頭に識別子を付ける
  - 例: old_department_id、new_department_id

#### フラグカラム
- **命名**: カラム名は _flag で終わる
  - 例: active_flag、delete_flag

#### 共通カラムの標準化
- **作成日時**: created_at（作成日時）
- **更新日時**: updated_at（更新日時）  
- **有効フラグ**: active_flag（有効フラグ）
- **名前系**: name（名前）、first_name（名）、last_name（姓）
- **コード系**: code（コード）
- **説明系**: description（説明）、notes（備考）

### データ型ルール
- **VARCHAR**: 255文字以下の場合に使用
- **VARCHAR(1)**: フラグ系はVARCHAR(1)
- **VARCHAR**: 選択肢はVARCHARの区分値で管理（文字列の数値管理）
- **TEXT**: 256文字以上の場合、またはVARCHAR(256)を超える場合に使用
- **INT**: ID系は基本的にINT
- **INT**: 金額や数値
- **DATETIME**: 日時系はDATETIME

### 制約ルール
- **PK（主キー）のみ記載**
- **その他制約は記載しない**
  - UNIQUE制約
  - FK（外部キー）制約
  - CHECK制約
  - INDEX制約

### 記載内容ルール

#### NULL許可
- NO: NULL不可
- YES: NULL許可

#### デフォルト
- AUTO_INCREMENT: 自動採番の場合
- NULL: デフォルトがNULLの場合（区分値も含む）
- '0': フラグ系の場合のみ
- 原則として具体的な値は設定しない

#### 制約カラム
- PK: 主キーの場合
- -: その他すべて（UNIQUE、FKなどは記載しない）

#### 説明カラム
- **空白（スペース2つ）で統一**
- 具体的な説明は記載しない

## 記載例

```markdown
## TBL名：mst_user（ユーザーマスタ）

### 1. テーブル概要
システムへのログインユーザー情報を管理する。

### 2. テーブル定義
| カラム名 | カラム名（論理名） | データ型 | サイズ | NULL許可 | デフォルト | 制約 | 説明 |
|----------|-------------------|----------|--------|----------|------------|------|------|
| id | ユーザーID | INT | - | NO | AUTO_INCREMENT | PK |  |
| employee_id | 社員ID | INT | - | YES | NULL | - |  |
| user_name | ユーザー名 | VARCHAR | 255 | NO | NULL | - |  |
| email | メールアドレス | VARCHAR | 255 | NO | NULL | - |  |
| password | パスワード | TEXT | - | NO | NULL | - |  |
| role | ユーザー権限 | VARCHAR | 10 | NO | NULL | - |  |
| active_flag | 有効フラグ | VARCHAR | 1 | NO | '0' | - |  |
| remember_token | ログイン保持トークン | VARCHAR | 100 | YES | NULL | - |  |
| created_at | 作成日時 | DATETIME | - | YES | NULL | - |  |
| updated_at | 更新日時 | DATETIME | - | YES | NULL | - |  |

### 3. 区分値定義

#### role（ユーザー権限）
- 1: 管理者権限
- 2: ユーザー権限
```

## チェックリスト

TBL定義書作成時は、以下をチェックしてください：

- [ ] TBL名が適切なプレフィックス（mst_/his_/tbl_）で始まっている
- [ ] ファイル名が `テーブル名（日本語名）.md` 形式になっている
- [ ] ディレクトリが `doc/B001_TBL定義/` 配下になっている
- [ ] カラム順序が正しい（PK → 外部キー → その他 → システムカラム）
- [ ] 制約はPKのみ記載されている
- [ ] ID系はINTになっている
- [ ] VARCHAR(256)以上はTEXTになっている
- [ ] フラグ系はVARCHAR(1)になっている
- [ ] 外部キーカラム名が適切な命名規則（テーブル名_id）になっている
- [ ] 同一テーブルの外部キーが複数ある場合、識別子が付いている
- [ ] フラグカラム名が_flagで終わっている
- [ ] 日時系はDATETIMEになっている
- [ ] 選択肢はVARCHARで管理されている
- [ ] フラグ系のデフォルトが'0'になっている
- [ ] 区分値（選択肢）のデフォルトがNULLになっている
- [ ] 具体的な初期値が不適切に設定されていない
- [ ] 区分値（選択肢）がある場合、3.区分値定義が記載されている
- [ ] 区分値の値と意味が適切に記載されている
- [ ] 説明カラムが空白（スペース2つ）になっている
- [ ] カラム名（論理名）が適切に記載されている
- [ ] カラム名と論理名が同じ意味になっている
- [ ] 同じ意味のカラムが他テーブルと一貫した命名になっている
- [ ] 共通カラムが標準化された命名になっている

## 注意事項

1. このルールは今後のTBL定義書作成時に必ず準拠すること
2. ルール変更が必要な場合は、このファイルを更新すること